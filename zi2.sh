#!/usr/bin/env bash
set -euo pipefail

# --- protected self-run wrapper ---
PASS="KangEnc"
MAC_EXPECT="2de3bd527a0b50f8044356b56174473d16550126d31b659ce65dccff9c1a1244"
DATA_B64="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"

MAC_GOT=$(printf "%s" "$DATA_B64" | openssl dgst -sha256 -hmac "$PASS" | awk '{print $NF}')
if [[ "$MAC_GOT" != "$MAC_EXPECT" ]]; then
  echo "‚ùå Protected file corrupted/modified"
  exit 1
fi

# decrypt + run (tanpa simpan file permanen)
# note: tetap bisa di-dump oleh user root yang niat, ini hanya mempersulit.
exec bash <(printf "%s" "$DATA_B64" | base64 -d | openssl enc -d -aes-256-cbc -pbkdf2 -iter 200000 -pass pass:"$PASS")
