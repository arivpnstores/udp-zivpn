#!/usr/bin/env bash
set -euo pipefail

# --- protected self-run wrapper ---
PASS="KangEnc"
MAC_EXPECT="e486e469d4f72affdf105e32723738d43e3308404eb50ad31c1f988e88d9c1fc"
DATA_B64="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36hskg=="

MAC_GOT=$(printf "%s" "$DATA_B64" | openssl dgst -sha256 -hmac "$PASS" | awk '{print $NF}')
if [[ "$MAC_GOT" != "$MAC_EXPECT" ]]; then
  echo "‚ùå Protected file corrupted/modified"
  exit 1
fi

# decrypt + run (tanpa simpan file permanen)
# note: tetap bisa di-dump oleh user root yang niat, ini hanya mempersulit.
exec bash <(printf "%s" "$DATA_B64" | base64 -d | openssl enc -d -aes-256-cbc -pbkdf2 -iter 200000 -pass pass:"$PASS")
