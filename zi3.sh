#!/usr/bin/env bash
set -euo pipefail

# --- protected self-run wrapper ---
PASS="KangEnc"
MAC_EXPECT="9a0a0459e6d5b9292377299d03c7cb5169c40859a1063f5eb4a433394142cee5"
DATA_B64="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"

MAC_GOT=$(printf "%s" "$DATA_B64" | openssl dgst -sha256 -hmac "$PASS" | awk '{print $NF}')
if [[ "$MAC_GOT" != "$MAC_EXPECT" ]]; then
  echo "‚ùå Protected file corrupted/modified"
  exit 1
fi

# decrypt + run (tanpa simpan file permanen)
# note: tetap bisa di-dump oleh user root yang niat, ini hanya mempersulit.
exec bash <(printf "%s" "$DATA_B64" | base64 -d | openssl enc -d -aes-256-cbc -pbkdf2 -iter 200000 -pass pass:"$PASS")
