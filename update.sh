#!/usr/bin/env bash
set -euo pipefail

# --- protected self-run wrapper ---
PASS="KangEnc"
MAC_EXPECT="692aa75151b31bd66e2b688fb07092dfb05f1b3f9f5db55ada25e94f9e5ae4ed"
DATA_B64="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"

MAC_GOT=$(printf "%s" "$DATA_B64" | openssl dgst -sha256 -hmac "$PASS" | awk '{print $NF}')
if [[ "$MAC_GOT" != "$MAC_EXPECT" ]]; then
  echo "‚ùå Protected file corrupted/modified"
  exit 1
fi

# decrypt + run (tanpa simpan file permanen)
# note: tetap bisa di-dump oleh user root yang niat, ini hanya mempersulit.
exec bash <(printf "%s" "$DATA_B64" | base64 -d | openssl enc -d -aes-256-cbc -pbkdf2 -iter 200000 -pass pass:"$PASS")
